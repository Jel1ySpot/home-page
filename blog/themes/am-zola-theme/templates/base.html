{% import "_macros.html" as macros %}
{% import "_funcs.html" as func %}
<!DOCTYPE html>
<html lang="{{ lang | default(value=config.default_language) }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ config.title }}{% endblock title %}</title>
    <link rel="stylesheet" href="{{ get_url(path="style.css") }}">
    <style>
        :root {
            --theme-color: {{ config.extra.theme_color | default(value="#ff2d55") }};
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="{{ get_url(path="js/background.js") }}"></script>
    <script src="{{ get_url(path="js/theme-toggle.js") }}"></script>
    <script src="{{ get_url(path="js/language-menu.js") }}"></script>
    <script src="{{ get_url(path="js/sidebar-toggle.js") }}"></script>
</head>
<body>
    <button class="sidebar-toggle" type="button" aria-expanded="true" aria-label="Toggle sidebar" data-sidebar-toggle>
        <span class="sidebar-toggle-icon">☰</span>
    </button>
    <div id="bg-canvas-container" 
         data-colors='{{ config.extra.background_colors | json_encode() | safe }}'
         data-colors-light='{{ config.extra.background_colors_light | default(value=config.extra.background_colors) | json_encode() | safe }}'
         data-colors-dark='{{ config.extra.background_colors_dark | default(value=config.extra.background_colors) | json_encode() | safe }}'
         style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -10; overflow: hidden;">
    </div>
    <div class="app-layout">
        <aside class="sidebar">
            <div class="card menu-card">
                <div class="menu-section">
                    {% if config.build_search_index %}
                    <div class="search-bar">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        <span>{{ func::t(key="search") }}</span>
                    </div>
                    {% endif %}
                    
                    <nav class="main-nav">
                        <ul>
                            <li>
                                <a href="{{ get_url(path="@/_index.md", lang=lang) }}" class="{% if current_path == "/" or current_path == "/" ~ lang ~ "/" %}active{% endif %}">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                                    {{ func::t(key="home") }}
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
                <div class="menu-section">
                    <h3 class="section-title">{{ func::t(key="section") }}</h3>
                    <nav class="sub-nav">
                        <ul>
                            {% set root_section = get_section(path="_index.md")%}
                            {% for section_path in root_section.subsections %}
                            {% set section = get_section(path=section_path)%}
                            <li>
                                <a href="{{ get_url(path=section.path, lang=lang) }}" class="{% if current_path is starting_with(section.path) or current_path is starting_with("/" ~ lang ~ section.path) %}active{% endif %}">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                                    {{ func::t(key=section.title) }}
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </nav>
                </div>

                <div class="menu-section">
                    <h3 class="section-title">{{ func::t(key="taxonomies") }}</h3>
                    <nav class="sub-nav">
                        <ul>
                            {% for taxonomy in config.taxonomies %}
                                {% if taxonomy.render %}
                                <li>
                                    <a href="{{get_url(path=taxonomy.slug, lang=lang)}}" class="{% if current_path is starting_with("/" ~ taxonomy.slug) or current_path is starting_with("/" ~ lang ~ "/" ~ taxonomy.slug) %}active{% endif %}">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
                                        {{ func::t(key=taxonomy.name) }}
                                    </a>
                                </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </nav>
                </div>
                
                <div class="sidebar-footer">
                    {% if config.languages %}
                    <div class="language-switcher" data-language-switcher>
                        <button class="language-trigger" type="button" aria-haspopup="true" aria-expanded="false">
                            <span>{{ func::t(key="language") }}</span>
                            <span class="language-trigger-icon">▾</span>
                        </button>
                        <div class="language-menu" role="menu">
                            {% for code, language in config.languages %}
                            <a class="language-option {% if lang == code %}is-active{% endif %}"
                               role="menuitem"
                               href="{{ get_url(path="@/_index.md", lang=code) }}">{{ code | upper }}</a>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    <button id="theme-toggle" class="theme-toggle-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                        <span class="theme-text" 
                              data-dark="{{ func::t(key="dark_mode") }}"
                              data-light="{{ func::t(key="light_mode") }}">{{ func::t(key="dark_mode") }}</span>
                    </button>
                </div>
            </div>
        </aside>

        <main class="main-content">
            {% block content %}{% endblock content %}
        </main>
    </div>
</body>
</html>
